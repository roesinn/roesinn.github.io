<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Frida to trigger XPC Activities | ro2en - tech blog</title>
<meta name=keywords content="frida"><meta name=description content='A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some XPC Activities. Those XPC Activities could be found in the daemon&rsquo;s configuration file (located at /System/Library/LaunchDaemons, with the .plist file extension) under the LaunchEvents field:
# example daemon: audioanalyticsd $ plutil -p "/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist" # ... "Label" => "com.apple.audioanalyticsd" "LaunchEvents" => { # XPC activities "com.'><meta name=author content="ro2en"><link rel=canonical href=https://ro2en.me/posts/xpcactivity/><link crossorigin=anonymous href=/assets/css/stylesheet.1fc7633352002c726fac2f2267f2f70aa2fd3784e85196c36b507bda4d3ee0ad.css integrity="sha256-H8djM1IALHJvrC8iZ/L3CqL9N4ToUZbDa1B72k0+4K0=" rel="preload stylesheet" as=style><link rel=icon href=https://ro2en.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ro2en.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ro2en.me/favicon-32x32.png><link rel=apple-touch-icon href=https://ro2en.me/apple-touch-icon.png><link rel=mask-icon href=https://ro2en.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ro2en.me/posts/xpcactivity/><link rel=alternate hreflang=zh href=https://ro2en.me/zh/posts/xpcactivity/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity=sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity=sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk crossorigin=anonymous onload=renderMathInElement(document.body)></script><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><meta property="og:title" content="Using Frida to trigger XPC Activities"><meta property="og:description" content='A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some XPC Activities. Those XPC Activities could be found in the daemon&rsquo;s configuration file (located at /System/Library/LaunchDaemons, with the .plist file extension) under the LaunchEvents field:
# example daemon: audioanalyticsd $ plutil -p "/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist" # ... "Label" => "com.apple.audioanalyticsd" "LaunchEvents" => { # XPC activities "com.'><meta property="og:type" content="article"><meta property="og:url" content="https://ro2en.me/posts/xpcactivity/"><meta property="og:image" content="https://ro2en.me/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-10T00:00:00+00:00"><meta property="og:see_also" content="https://ro2en.me/posts/securitypara/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ro2en.me/images/papermod-cover.png"><meta name=twitter:title content="Using Frida to trigger XPC Activities"><meta name=twitter:description content='A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some XPC Activities. Those XPC Activities could be found in the daemon&rsquo;s configuration file (located at /System/Library/LaunchDaemons, with the .plist file extension) under the LaunchEvents field:
# example daemon: audioanalyticsd $ plutil -p "/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist" # ... "Label" => "com.apple.audioanalyticsd" "LaunchEvents" => { # XPC activities "com.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ro2en.me/posts/"},{"@type":"ListItem","position":2,"name":"Using Frida to trigger XPC Activities","item":"https://ro2en.me/posts/xpcactivity/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Frida to trigger XPC Activities","name":"Using Frida to trigger XPC Activities","description":"A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some XPC Activities. Those XPC Activities could be found in the daemon\u0026rsquo;s configuration file (located at /System/Library/LaunchDaemons, with the .plist file extension) under the LaunchEvents field:\n# example daemon: audioanalyticsd $ plutil -p \u0026#34;/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist\u0026#34; # ... \u0026#34;Label\u0026#34; =\u0026gt; \u0026#34;com.apple.audioanalyticsd\u0026#34; \u0026#34;LaunchEvents\u0026#34; =\u0026gt; { # XPC activities \u0026#34;com.","keywords":["frida"],"articleBody":"A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some XPC Activities. Those XPC Activities could be found in the daemon’s configuration file (located at /System/Library/LaunchDaemons, with the .plist file extension) under the LaunchEvents field:\n# example daemon: audioanalyticsd $ plutil -p \"/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist\" # ... \"Label\" =\u003e \"com.apple.audioanalyticsd\" \"LaunchEvents\" =\u003e { # XPC activities \"com.apple.xpc.activity\" =\u003e { \"com.apple.audioanalyticsd.assets.refresh\" =\u003e { \"AllowBattery\" =\u003e 0 \"GracePeriod\" =\u003e 1800 \"Interval\" =\u003e 43200 # interval 12h = 43200s/3600s \"Priority\" =\u003e \"Maintenance\" \"Repeating\" =\u003e 1 } } } \"ProgramArguments\" =\u003e [ 0 =\u003e \"/usr/libexec/audioanalyticsd\" ] # ... However, those XPC activities usually have pre-defined intervals for periodically running, 12 hours in the above example, and up to 24 hours in some cases; some even should wait for certain system conditions to be satisfied. Of this reason, it is hard to analyze them especially when we require to debug them on demand. So I was looking for a way to run these XPC activities manually.\nI was inspired by this article by Bryce. By investigating the logs in the Console application, he discovered that a daemon called dasd (DuetActivitySchedulerDaemon) deciding which activities to run and when to run them. He used a debug tool lldb to debug the dasd: 1) get the instance of the _DASDaemon class, 2) call its method - [_DASDaemon forceRunActivities:]. And, it successfully triggered the corresponding XPC activity!\n(lldb) e (void)[[_DASDaemon sharedInstance] forceRunActivities:@[@\"com.apple.CacheDelete.daily\"]] Next step, he built a command line tool which puts the rewritten forceRunActivities:completion: method in a new protocol, then uses Theos to hook the XPC communication interface class NSXPCInterface and, after _DASDaemonClient (share the same selector with _DASDaemon) is loaded, replacing the original method of the original protocol in dasd with the new method of the new protocol through XPC communication, in order to invoke the specific XPC activity and provide feedback.\nBut the method is still too much complicated. An easier path is to use Frida to hook the dasd by loading Javascript script.\nTest in Frida CLI Our idea is clear: access the instance of the _DASDaemon class, then call its -[_DASDaemon forceRunActivities:] method.\nFor the very beginning, use Frida CLI to dynamically debug dasd.\nfrida -U dasd Try to get the instance of the _DASDaemon class as an Objective-C object.\n// Get instance of _DASDaemon class -\u003e sharedInstance = ObjC.classes._DASDaemon.sharedInstance(); // Convert the instance to an ObjC object -\u003e sharedInstance = new ObjC.Object(sharedInstance); After obtaining the instance, try to call the forceRunActivities: method. From Bryce’s blog, we learned that the argument of the method is an array of strings, storing the XPC activity’s name. So the trick is, we use the [NSString stringWithString:] method to store the name of the targeted XPC Activity into a string of type NSString, then put the string into an array of type NSArray, which is passed as the parameter to -[_DASDaemon forceRunActivities:] method. Note that NSString and NSArray need to be declared as Objective-C classes in advance, otherwise an error will be reported.\n// declare ObjC classes -\u003e const { NSString, NSArray } = ObjC.classes; // initiate an ObjC string with value -\u003e const activity_string = NSString['stringWithString:']('com.apple.audioanalyticsd.assets.refresh'); // initiate an ObjC array with value -\u003e const activity_array = NSArray.alloc().initWithObject_(activity_string); // call method of the instance -\u003e sharedInstance.forceRunActivities_(activity_array); In the Console application, we observed that the specific XPC activity is launched successfully! Our next step is to write them as a JS script to be loaded directly by Frida.\nLoad JS script by Frida We built the following JS script and encapsulated the behavior of calling the -[_DASDaemon forceRunActivities:] method into a function run_activity:\n// dasd_schedule_activity.js console.log(\"reloaded script\"); var sharedInstance = ObjC.classes._DASDaemon.sharedInstance(); sharedInstance = new ObjC.Object(sharedInstance); console.log(\"Got DASDaemon instance: \" + sharedInstance); function run_activity(activity_name) { const {NSString, NSArray} = ObjC.classes; const activity_string = NSString['stringWithString:'](activity_name); const activity_array = NSArray.alloc().initWithObject_(activity_string); sharedInstance.forceRunActivities_(activity_array); console.log(\"ran activity\"); } console.log(\"run_activity('xpc_activity_name')\"); Load the JS script by frida, then run the run_activity function to invoke any XPC activity:\nfrida -U dasd --load dasd_schedule_activity.js -\u003e run_activity('your_xpc_activity_name') Done! Now you can invoke any XPC activities on demand.\n(Special thanks to Jiska)\n","wordCount":"685","inLanguage":"en","image":"https://ro2en.me/images/papermod-cover.png","datePublished":"2023-08-10T00:00:00Z","dateModified":"2023-08-10T00:00:00Z","author":[{"@type":"Person","name":"ro2en"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://ro2en.me/posts/xpcactivity/"},"publisher":{"@type":"Organization","name":"ro2en - tech blog","logo":{"@type":"ImageObject","url":"https://ro2en.me/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ro2en.me/ class=logo-text accesskey=h title="ro2en - tech blog (Alt + H)">ro2en - tech blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"><path id="adjust-solid" d="M8 17a9 9 0 109-9A9 9 0 008 17zm9 6.677V10.323a6.677 6.677.0 110 13.355z" transform="translate(12.728 -11.314) rotate(45)" fill="currentcolor"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"><path id="adjust-solid" d="M8 17a9 9 0 109-9A9 9 0 008 17zm9 6.677V10.323a6.677 6.677.0 110 13.355z" transform="translate(12.728 -11.314) rotate(45)" fill="currentcolor"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ro2en.me/zh/ title=Chinese aria-label=zh>zh</a></li></ul></div></div><ul id=menu><li><a href=https://ro2en.me/archives title=Archive><span>Archive</span></a></li><li><a href=https://ro2en.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ro2en.me/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ro2en.me/>Home</a>&nbsp;»&nbsp;<a href=https://ro2en.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Using Frida to trigger XPC Activities</h1><div class=post-meta><span title='2023-08-10 00:00:00 +0000 UTC'>August 10, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;ro2en&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://ro2en.me/zh/posts/xpcactivity/>zh</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#test-in-frida-cli aria-label="Test in Frida CLI">Test in Frida CLI</a></li><li><a href=#load-js-script-by-frida aria-label="Load JS script by Frida">Load JS script by Frida</a></li></ul></div></details></div><div class=post-content><p>A few months ago, I need to conduct dynamic analysis of a Daemon in a jailbroken iOS device, where the daemon is make up of some <strong>XPC Activities</strong>. Those <strong>XPC Activities</strong> could be found in the daemon&rsquo;s configuration file (located at <code>/System/Library/LaunchDaemons</code>, with the <code>.plist</code> file extension) under the <code>LaunchEvents</code> field:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># example daemon: audioanalyticsd</span>
</span></span><span class=line><span class=cl>$ plutil -p <span class=s2>&#34;/System/Library/LaunchDaemons/com.apple.audioanalyticsd.plist&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;Label&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;com.apple.audioanalyticsd&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;LaunchEvents&#34;</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># XPC activities</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;com.apple.xpc.activity&#34;</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;com.apple.audioanalyticsd.assets.refresh&#34;</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AllowBattery&#34;</span> <span class=o>=</span>&gt; <span class=m>0</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;GracePeriod&#34;</span> <span class=o>=</span>&gt; <span class=m>1800</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Interval&#34;</span> <span class=o>=</span>&gt; <span class=m>43200</span>  <span class=c1># interval 12h = 43200s/3600s</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Priority&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;Maintenance&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Repeating&#34;</span> <span class=o>=</span>&gt; <span class=m>1</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;ProgramArguments&#34;</span> <span class=o>=</span>&gt; <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=nv>0</span> <span class=o>=</span>&gt; <span class=s2>&#34;/usr/libexec/audioanalyticsd&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span></code></pre></div><p>However, those XPC activities usually have pre-defined intervals for periodically running, 12 hours in the above example, and up to 24 hours in some cases; some even should wait for certain system conditions to be satisfied. Of this reason, it is hard to analyze them especially when we require to debug them on demand. So I was looking for a way to run these XPC activities manually.</p><p>I was inspired by <a href=https://bryce.co/running-xpc-activities-on-demand/>this article by Bryce</a>. By investigating the logs in the Console application, he discovered that a daemon called <code>dasd</code> (DuetActivitySchedulerDaemon) deciding which activities to run and when to run them. He used a debug tool <a href=https://lldb.llvm.org/>lldb</a> to debug the <code>dasd</code>: 1) get the instance of the <code>_DASDaemon</code> class, 2) call its method <code>- [_DASDaemon forceRunActivities:]</code>. And, it successfully triggered the corresponding XPC activity!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span>lldb<span class=o>)</span> e <span class=o>(</span>void<span class=o>)[[</span>_DASDaemon sharedInstance<span class=o>]</span> 
</span></span><span class=line><span class=cl>	forceRunActivities:@<span class=o>[</span>@<span class=s2>&#34;com.apple.CacheDelete.daily&#34;</span><span class=o>]]</span>
</span></span></code></pre></div><p>Next step, he built a command line tool which puts the rewritten <code>forceRunActivities:completion:</code> method in a new protocol, then uses <a href=https://github.com/theos/theos>Theos</a> to hook the XPC communication interface class <code>NSXPCInterface</code> and, after <code>_DASDaemonClient</code> (share the same selector with <code>_DASDaemon</code>) is loaded, replacing the original method of the original protocol in <code>dasd</code> with the new method of the new protocol through XPC communication, in order to invoke the specific XPC activity and provide feedback.</p><p>But the method is still too much complicated. An easier path is to use <a href=https://frida.re/>Frida</a> to hook the <code>dasd</code> by loading Javascript script.</p><h3 id=test-in-frida-cli>Test in Frida CLI<a hidden class=anchor aria-hidden=true href=#test-in-frida-cli>#</a></h3><blockquote><p>Our idea is clear: access the instance of the <code>_DASDaemon</code> class, then call its <code>-[_DASDaemon forceRunActivities:]</code> method.</p></blockquote><p>For the very beginning, use Frida CLI to dynamically debug <code>dasd</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida -U dasd
</span></span></code></pre></div><p>Try to get the instance of the <code>_DASDaemon</code> class as an Objective-C object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Get instance of _DASDaemon class
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=nx>sharedInstance</span> <span class=o>=</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nx>classes</span><span class=p>.</span><span class=nx>_DASDaemon</span><span class=p>.</span><span class=nx>sharedInstance</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Convert the instance to an ObjC object
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=nx>sharedInstance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nb>Object</span><span class=p>(</span><span class=nx>sharedInstance</span><span class=p>);</span>
</span></span></code></pre></div><p>After obtaining the instance, try to call the <code>forceRunActivities:</code> method. From Bryce&rsquo;s blog, we learned that the argument of the method is an <strong>array of strings</strong>, storing the XPC activity&rsquo;s name. So the trick is, we use the <code>[NSString stringWithString:]</code> method to store the name of the targeted XPC Activity into a string of type <code>NSString</code>, then put the string into an array of type <code>NSArray</code>, which is passed as the parameter to <code>-[_DASDaemon forceRunActivities:]</code> method. Note that <code>NSString</code> and <code>NSArray</code> need to be declared as Objective-C classes in advance, otherwise an error will be reported.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// declare ObjC classes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=kr>const</span> <span class=p>{</span> <span class=nx>NSString</span><span class=p>,</span> <span class=nx>NSArray</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nx>classes</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// initiate an ObjC string with value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=kr>const</span> <span class=nx>activity_string</span> <span class=o>=</span> <span class=nx>NSString</span><span class=p>[</span><span class=s1>&#39;stringWithString:&#39;</span><span class=p>](</span><span class=s1>&#39;com.apple.audioanalyticsd.assets.refresh&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// initiate an ObjC array with value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=kr>const</span> <span class=nx>activity_array</span> <span class=o>=</span> <span class=nx>NSArray</span><span class=p>.</span><span class=nx>alloc</span><span class=p>().</span><span class=nx>initWithObject_</span><span class=p>(</span><span class=nx>activity_string</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// call method of the instance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-&gt;</span> <span class=nx>sharedInstance</span><span class=p>.</span><span class=nx>forceRunActivities_</span><span class=p>(</span><span class=nx>activity_array</span><span class=p>);</span>
</span></span></code></pre></div><p>In the Console application, we observed that the specific XPC activity is launched successfully! Our next step is to write them as a JS script to be loaded directly by Frida.</p><h3 id=load-js-script-by-frida>Load JS script by Frida<a hidden class=anchor aria-hidden=true href=#load-js-script-by-frida>#</a></h3><p>We built the following JS script and encapsulated the behavior of calling the <code>-[_DASDaemon forceRunActivities:]</code> method into a function <code>run_activity</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// dasd_schedule_activity.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;reloaded script&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>sharedInstance</span> <span class=o>=</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nx>classes</span><span class=p>.</span><span class=nx>_DASDaemon</span><span class=p>.</span><span class=nx>sharedInstance</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>sharedInstance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nb>Object</span><span class=p>(</span><span class=nx>sharedInstance</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Got DASDaemon instance: &#34;</span> <span class=o>+</span> <span class=nx>sharedInstance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>run_activity</span><span class=p>(</span><span class=nx>activity_name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span><span class=nx>NSString</span><span class=p>,</span> <span class=nx>NSArray</span><span class=p>}</span> <span class=o>=</span> <span class=nx>ObjC</span><span class=p>.</span><span class=nx>classes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>activity_string</span> <span class=o>=</span> <span class=nx>NSString</span><span class=p>[</span><span class=s1>&#39;stringWithString:&#39;</span><span class=p>](</span><span class=nx>activity_name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>activity_array</span> <span class=o>=</span> <span class=nx>NSArray</span><span class=p>.</span><span class=nx>alloc</span><span class=p>().</span><span class=nx>initWithObject_</span><span class=p>(</span><span class=nx>activity_string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>sharedInstance</span><span class=p>.</span><span class=nx>forceRunActivities_</span><span class=p>(</span><span class=nx>activity_array</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;ran activity&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;run_activity(&#39;xpc_activity_name&#39;)&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Load the JS script by frida, then run the <code>run_activity</code> function to invoke any XPC activity:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida -U dasd --load dasd_schedule_activity.js
</span></span><span class=line><span class=cl>-&gt; run_activity<span class=o>(</span><span class=s1>&#39;your_xpc_activity_name&#39;</span><span class=o>)</span>
</span></span></code></pre></div><p>Done! Now you can invoke any XPC activities on demand.</p><p>(Special thanks to <a href=https://twitter.com/naehrdine>Jiska</a>)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ro2en.me/tags/frida/>Frida</a></li></ul><nav class=paginav><a class=next href=https://ro2en.me/posts/securitypara/><span class=title>Next »</span><br><span>Security Parameters in Cryptographic Protocols</span></a></nav></footer><div id=waline></div><script type=module>
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    init({
      el: '#waline',
      serverURL: 'https://waline-comment-ej99wzs72-roesinns-projects.vercel.app/',
      lang: 'en',
    });
</script></article></main><footer class=footer><span>© 2016-2024 ro2en - tech blog.</span>
All rights reserved.</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"egin{equation}",right:"end{equation}",display:!0},{left:"egin{align}",right:"end{align}",display:!0}],throwOnError:!1})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>